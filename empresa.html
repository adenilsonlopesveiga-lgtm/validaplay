<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Enviar Aplicativo para Teste - ValidaPlay</title>

<style>
body{
    margin:0;
    font-family:Arial;
    background:#0f172a;
    color:white;
}

.container{
    max-width:600px;
    margin:60px auto;
    background:#020617;
    padding:30px;
    border-radius:12px;
    border:1px solid #1e293b;
}

h1{
    text-align:center;
    color:#38bdf8;
}

label{
    display:block;
    margin-top:15px;
    margin-bottom:5px;
}

input, textarea, select{
    width:100%;
    padding:12px;
    border-radius:6px;
    border:none;
    background:#020617;
    border:1px solid #334155;
    color:white;
}

textarea{
    height:120px;
}

button{
    margin-top:25px;
    width:100%;
    padding:14px;
    background:#38bdf8;
    border:none;
    border-radius:8px;
    font-size:16px;
    font-weight:bold;
    cursor:pointer;
}

.link-login{
    display:block;
    text-align:center;
    margin-top:20px;
    color:#38bdf8;
    text-decoration:none;
}
</style>
</head>

<body>

<div class="container">

<h1>Enviar aplicativo para teste</h1>

<label>Nome do aplicativo</label>
<input type="text" id="app">

<label>Seu email</label>
<input type="email" id="email">

<label>Senha</label>
<input type="password" id="senha" placeholder="MÃ­nimo 6 caracteres">

<label>Seu telefone / WhatsApp</label>
<input type="text" id="whatsapp" placeholder="(DDD) 99999-9999">

<label>Link do grupo de testadores (Google Groups)</label>
<input type="text" id="grupo" placeholder="https://groups.google.com/g/seuapp">

<label>Link para tornar-se testador</label>
<input type="text" id="linkTeste" placeholder="https://play.google.com/apps/testing/com.seuapp">

<label>Link do aplicativo na Play Store (opcional)</label>
<input type="text" id="linkLoja" placeholder="https://play.google.com/store/apps/details?id=com.seuapp">

<label>Quantidade de testadores desejada</label>
<select id="quantidade"></select>

<<label>Prazo do teste</label>
<select id="prazo">
  <option>14 dias</option>
</select>


<label>InstruÃ§Ãµes para os testadores (login, senha, como usar)</label>
<textarea id="instrucoes"></textarea>

<button id="enviar">Enviar solicitaÃ§Ã£o</button>

<a href="login-desenvolvedor.html" class="link-login">
JÃ¡ sou desenvolvedor (Login)
</a>

</div>

<script type="module">

import { db, auth } from "./firebase.js";
import { collection, addDoc, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

/* ðŸ”¢ GERAR OPÃ‡Ã•ES 1 A 50 AUTOMATICAMENTE */
const selectQuantidade = document.getElementById("quantidade");
for(let i=1;i<=50;i++){
  const option = document.createElement("option");
  option.value = i;
  option.textContent = i + " testador" + (i>1?"es":"");
  if(i === 12) option.selected = true; // padrÃ£o 12
  selectQuantidade.appendChild(option);
}

const botao = document.getElementById("enviar");

botao.addEventListener("click", async () => {

  const nomeApp = document.getElementById("app").value.trim();
  const email = document.getElementById("email").value.trim();
  const senha = document.getElementById("senha").value.trim();
  const grupo = document.getElementById("grupo").value.trim();
  const linkTeste = document.getElementById("linkTeste").value.trim();
  const whatsapp = document.getElementById("whatsapp").value.trim();
  const linkLoja = document.getElementById("linkLoja").value.trim();
  const quantidade = Number(document.getElementById("quantidade").value);
  const prazo = document.getElementById("prazo").value;
  const instrucoes = document.getElementById("instrucoes").value.trim();

  if(!nomeApp || !email || !senha || !linkTeste){
    alert("Preencha nome do app, email, senha e link do teste.");
    return;
  }

  if(senha.length < 6){
    alert("A senha deve ter pelo menos 6 caracteres.");
    return;
  }

  try {

    botao.disabled = true;
    botao.innerText = "Criando conta e enviando...";

    /* ðŸ” 1 â€” Criar conta no Auth */
    const userCredential = await createUserWithEmailAndPassword(auth, email, senha);
    const user = userCredential.user;

    /* ðŸ’¾ 2 â€” Salvar desenvolvedor */
    await setDoc(doc(db, "desenvolvedores", user.uid), {
      email,
      whatsapp,
      criadoEm: new Date()
    });

    /* ðŸ“¦ 3 â€” Salvar solicitaÃ§Ã£o vinculada */
    await addDoc(collection(db, "solicitacoes"), {
      desenvolvedorId: user.uid,
      nomeApp,
      email,
      whatsapp,
      grupo,
      linkTeste,
      linkLoja,
      quantidade,
      prazo,
      instrucoes,
      status: "novo",
      criadoEm: new Date()
    });

    document.querySelector(".container").innerHTML = `
      <h1>Aplicativo enviado com sucesso ðŸš€</h1>
      <p>VocÃª jÃ¡ pode acompanhar o status no seu painel.</p>
      <a href="login-desenvolvedor.html" style="
          display:inline-block;
          margin-top:20px;
          padding:12px 20px;
          background:#38bdf8;
          color:#020617;
          border-radius:8px;
          text-decoration:none;
          font-weight:bold;
      ">
          Ir para login
      </a>
    `;

  } catch (error) {

    console.error(error);
    alert("Erro ao criar conta. Verifique se o email jÃ¡ estÃ¡ em uso.");

    botao.disabled = false;
    botao.innerText = "Enviar solicitaÃ§Ã£o";
  }

});
</script>

</body>
</html>
