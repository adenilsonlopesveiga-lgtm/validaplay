<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Painel Admin - ValidaPlay</title>

<style>
body{
    margin:0;
    font-family:Arial;
    background:#0f172a;
    color:white;
}

header{
    background:#020617;
    padding:20px;
    text-align:center;
    border-bottom:1px solid #1e293b;
}

h1{
    color:#38bdf8;
}

.main{
    display:flex;
    gap:20px;
    padding:20px;
}

.coluna{
    flex:1;
    min-width:300px;
}

.tituloColuna{
    font-size:22px;
    margin-bottom:15px;
    color:#38bdf8;
    border-bottom:1px solid #1e293b;
    padding-bottom:10px;
}

.card{
    background:#020617;
    border:1px solid #1e293b;
    border-radius:10px;
    padding:15px;
    margin-bottom:15px;
}

.nome{
    font-size:18px;
    color:#38bdf8;
    font-weight:bold;
}

.info{
    color:#cbd5e1;
    margin-top:4px;
}

pre{
    white-space: pre-wrap;
    background:#0f172a;
    padding:10px;
    border-radius:6px;
    color:#38bdf8;
    margin-top:5px;
    font-size:13px;
}

button{
    margin-top:10px;
    padding:8px 12px;
    border:none;
    border-radius:6px;
    color:white;
    cursor:pointer;
    margin-right:5px;
}

.btn-danger{ background:#ef4444; }
.btn-success{ background:#22c55e; }
.btn-warning{ background:#f59e0b; }
.btn-secondary{ background:#64748b; }

.status-aprovado{ color:#22c55e; }
.status-bloqueado{ color:#ef4444; }
.status-pendente{ color:#f59e0b; }
.status-rejeitado{ color:#64748b; }

</style>
</head>

<body>

<header>
<h1>Painel Administrativo - ValidaPlay</h1>
</header>

<div class="main">

<div class="coluna">
    <div class="tituloColuna">Solicita√ß√µes de Empresas</div>
    <div id="listaSolicitacoes">Carregando...</div>
</div>

<div class="coluna">
    <div class="tituloColuna">Testadores Cadastrados</div>
    <div id="listaTestadores">Carregando...</div>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { 
  getFirestore, 
  collection, 
  getDocs, 
  query, 
  orderBy,
  deleteDoc,
  doc,
  updateDoc
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "validaplay.firebaseapp.com",
  projectId: "validaplay",
  storageBucket: "validaplay.firebasestorage.app",
  messagingSenderId: "731420070879",
  appId: "1:731420070879:web:2b7a466b362211d8256a6a"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

/* üîê PROTE√á√ÉO */
onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.href = "login.html";
  } else {
    carregarSolicitacoes();
    carregarTestadores();
  }
});

/* üî• EXCLUIR */
async function excluirRegistro(colecao, id){
  const confirmar = confirm("Tem certeza que deseja excluir?");
  if(!confirmar) return;

  await deleteDoc(doc(db, colecao, id));

  if(colecao === "solicitacoes"){
    carregarSolicitacoes();
  } else {
    carregarTestadores();
  }
}

/* üîÑ ATUALIZAR STATUS */
async function atualizarStatus(colecao, id, novoStatus){
  await updateDoc(doc(db, colecao, id), {
    status: novoStatus
  });

  if(colecao === "solicitacoes"){
    carregarSolicitacoes();
  } else {
    carregarTestadores();
  }
}

window.excluirRegistro = excluirRegistro;
window.atualizarStatus = atualizarStatus;

/* üîµ EMPRESAS */
async function carregarSolicitacoes(){
    const lista = document.getElementById("listaSolicitacoes");
    lista.innerHTML = "";

    const q = query(collection(db, "solicitacoes"), orderBy("criadoEm","desc"));
    const snap = await getDocs(q);

    if(snap.empty){
        lista.innerHTML = "Nenhuma solicita√ß√£o encontrada.";
        return;
    }

    snap.forEach(docSnap=>{
        const s = docSnap.data();
        const id = docSnap.id;
        const status = s.status || "pendente";

        const div = document.createElement("div");
        div.className="card";

        div.innerHTML=`
<div class="nome">${s.nomeApp || "App sem nome"}</div>
<div class="info">Email: ${s.email || "-"}</div>
<div class="info">Link: ${s.linkTeste || "-"}</div>
<div class="info">Quantidade: ${s.quantidade || "-"}</div>
<div class="info">Prazo: ${s.prazo || "-"}</div>

<div class="info">Status:
  <strong class="status-${status}">
    ${status}
  </strong>
</div>

<div style="margin-top:10px;">
  ${status === "pendente" ? `
    <button class="btn-success" onclick="atualizarStatus('solicitacoes','${id}','aprovado')">Aprovar</button>
    <button class="btn-secondary" onclick="atualizarStatus('solicitacoes','${id}','rejeitado')">Rejeitar</button>
  ` : ''}

  ${status === "aprovado" ? `
    <button class="btn-warning" onclick="atualizarStatus('solicitacoes','${id}','bloqueado')">Bloquear</button>
  ` : ''}

  ${status === "bloqueado" ? `
    <button class="btn-success" onclick="atualizarStatus('solicitacoes','${id}','aprovado')">Reativar</button>
  ` : ''}

  <button class="btn-danger" onclick="excluirRegistro('solicitacoes','${id}')">Excluir</button>
</div>

<div class="info" style="margin-top:10px;">
<strong>Instru√ß√µes:</strong>
</div>

<pre>${s.instrucoes || "Nenhuma instru√ß√£o informada"}</pre>
`;

        lista.appendChild(div);
    });
}

/* üü¢ TESTADORES */
async function carregarTestadores(){
    const lista = document.getElementById("listaTestadores");
    lista.innerHTML = "";

    const q = query(collection(db,"testadores"), orderBy("criadoEm","desc"));
    const snap = await getDocs(q);

    if(snap.empty){
        lista.innerHTML = "Nenhum testador cadastrado.";
        return;
    }

    snap.forEach(docSnap=>{
        const t = docSnap.data();
        const id = docSnap.id;
        const status = t.status || "pendente";

        const div = document.createElement("div");
        div.className="card";

        div.innerHTML=`
<div class="nome">${t.nome || "Sem nome"}</div>
<div class="info">Email: ${t.email || "-"}</div>
<div class="info">WhatsApp: ${t.whatsapp || "-"}</div>
<div class="info">Tipo de celular: ${t.tipoCelular || "-"}</div>
<div class="info">Modelo: ${t.modelo || "-"}</div>
<div class="info">Vers√£o: ${t.versao || "-"}</div>

<div class="info">Status:
  <strong class="status-${status}">
    ${status}
  </strong>
</div>

<div style="margin-top:10px;">
  ${status === "pendente" ? `
    <button class="btn-success" onclick="atualizarStatus('testadores','${id}','aprovado')">Aprovar</button>
  ` : ''}

  ${status === "aprovado" ? `
    <button class="btn-warning" onclick="atualizarStatus('testadores','${id}','bloqueado')">Bloquear</button>
  ` : ''}

  ${status === "bloqueado" ? `
    <button class="btn-success" onclick="atualizarStatus('testadores','${id}','aprovado')">Reativar</button>
  ` : ''}

  <button class="btn-danger" onclick="excluirRegistro('testadores','${id}')">Excluir</button>
</div>
`;

        lista.appendChild(div);
    });
}

</script>


</body>
</html>
